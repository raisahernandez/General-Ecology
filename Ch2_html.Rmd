---
title: "<center>Biostatistics - BIOL 260"
author: "<center>*Lab 2: Sampling data, accuracy and precision*"
output:
  html_document: default
  pdf_document: default
---

<style type="text/css">
.main-container {
  max-width: 800px;
}
pre code, pre, code {
  white-space: pre !important;
  overflow-x: scroll !important;
  word-break: keep-all !important;
  word-wrap: initial !important;
}
/* Whole document: */
body{
  font-family: helvetica;
  font-size: 12pt;
}
code {white-space:pre !important; overflow-x:scroll !important;font-size:12pt; font-family:courier;}
</style>


<br><br>
<style>
body {
text-align: justify}
div.blue { background-color:#e6f0ff; border-radius: 5px; padding: 20px;}
</style>
<div class = "blue">

**Today's investigation.** Sampling living things is a basic practice in biology; after all, we can't measure every member in a population. Biologists are constrained by logistics, time and funding and thus rely on measuring *samples*. As the features characterizing a sample are not identical to those characterizing the whole population, measurements made from a sample are affected by who gets sampled and who does not. Even more challenging, measurements from samples also depend on who is sampling the individuals (us!). Today, we will explore some of the factors that give rise to sampling error and, consequently, decrease measurement precision and accuracy through digital image analysis of carnivore skulls from CSU Long Beach CNSM Vertebrate Collections.
</div>

***


<span style='color:#66023C; font-size:150%; font-weight:600'> Introduction </span>
<br>

In this lab we will explore the difference between measurement accuracy and precision, while getting some hands on experience on digital image analysis. A fundamental task among biologists is to minimize both *sampling error* or the difference between our estimate and the true population parameter due to chance, and *bias* or the systematic discrepancy between our estimate and the true population parameter. For example, a group of estimates can have high accuracy and low precision, while others can be inaccurate but very precised. As you might guess, both high measurement accuracy and precision are important in order to be closer to the truth. So, how can we determine precision and accuracy in our measurements in order to avoid error and bias?    

Today, we will measure the canine length of carnivores using linear distances on digital images to quantify measurement  accuracy and precision (Fig. 1), and contrast between sampling error, bias, and objectivity in measurement recording. Digital image analysis provides means to increase precision (e.g., high resolution) but it can also be a source of bias (e.g., curvature of the visual field by the lens). However, not only this measurement process affects our estimates, we can also be a source of error and bias through poor scaling or other visual limitations. So, let's first explore and quantify measurement accuracy and precision in our own estimates, then in the Take-home excersice we will analyze the entire group's data to investigate how sample size affects accuracy and precision.   

<br>

```{r echo=FALSE,fig.align="center",fig.asp=.3,fig.cap="Figure 1. Coyote skull and upper right canine, CSU Long Beach CNSM Vertebrate Collection."}
library(png)
library(grid)
img <- readPNG("image0.png")
 grid.raster(img)
```

<br>

**Upon completion of this lab, you should be able to:**

  + Quantify the accuracy of measurements;
  + Quantify the precision of measurements;
  + Compare and contrast sampling error, bias, and objectivity in measurement recording.

<br>

**External study resources**

  + [Accuracy and Precision](https://www.youtube.com/watch?v=0IiHPKAvo7g)


***

<span style='color:#66023C; font-size:150%; font-weight:600'> Worked example </span> 
<br>

To get started, let’s remind ourselves the definitions of accuracy and precision:

  + accuracy - the closeness of the measurements to a particular value, say the *true value* 
  + precision - the closeness of the measurements to each other

By definition, accuracy and precision are independent of each other but both affect the conclusions of any investigation. Say that you recorded nine measurements (orange dots in Fig. 2) ranging from 7.1 to 11.2 units and a mean value of 8.3 units. The *difference* between the minimum and maximum values (the range) is your *precision*, which in this case is 4.1 units. Thus, a measurement recorded as 8.3 units would imply the individual presents a value higher than 4.2 units but smaller than 12.4 units (8.3 ± 4.1 units). This is independent from your measurement accuracy. Here, the true value is 3 units (black dot in Fig. 2), which is 4.1 units different from the minimum value and 8.2 units different from the maximum value, and 5.3 units different from the mean value. So, with the available information, we can argue that the measurements are relatively precise but highly inaccurate (no single estimate is close to the true value).      
<br>

```{r,echo=FALSE,fig.align="center",fig.asp=.4,fig.cap="Figure 2. Measurement accuracy and precision given its true value."}
library(ggplot2)
df <- as.data.frame(c(3,7.3,7.8,10.2,9.8,8.5,11.2,8.8,7.1,9))
df$y <- 0
names(df)[1] <- "x"

ggplot(df,aes(x,y)) +
  geom_point(color=c("black","orange","orange","orange","orange","orange","orange","orange","orange","orange"),size=c(5,3,3,3,3,3,3,3,3,3)) +
  geom_hline(yintercept=0,size=.2) +
  geom_segment(aes(x = 7.1, y = 0.08, xend = 11.2, yend = 0.08),color="blue") +
  geom_segment(aes(x = 3, y = 0.18, xend = 9.4, yend = 0.18),color="red") +
  annotate("text", x=9.1, y=.13, label= "Precision",size=7) +
  annotate("text", x=3, y=-0.06, label= "True value",size=7) +
  annotate("text", x=6.2, y=0.22, label= "Accuracy",size=7) +
  scale_x_continuous(expand = c(0, 0),limits = c(0,12),breaks = c(seq(0,12,1))) + 
  scale_y_continuous(expand = c(0, 0),limits = c(-.25,.25),breaks = c(-.35,0,.35)) + 
  ylab("") +
  xlab("") +
  theme_bw(20) +
  theme(panel.border = element_blank(), axis.line.x = element_line(), axis.line.y = element_line()) 
```
***

<br>
<span style='color:#66023C; font-size:150%; font-weight:600'> Materials and Methods </span> 
<br>

  + [Image J](https://imagej.nih.gov/ij/download.html) 
  + R and RStudio
  + Digital images of carnivore skulls (coyote, bob cat, kangaroo rat)
<br><br>

**A. Digital image analysis**

1. If you have not done so already, download Image J.
2. Open an excel spread sheet and name it: **LastnameFirstname_Species_Measurements**
    + Create the following header of 4 columns: “image_number” “specimen_id” “tooth” “length_cm”. The information for this header can be foun in the image file name. For example: the name of the first image for the bob cat specimen is "1-BCat_L21_lwr_left". Thus, the image_number is 1, the specimen_id is BCat_L21, and the tooth is lwr_left. Length_cm is the canine length measurement you will make later.
    + Save this file and keep it open, you will use it to record all measurements
3. Open ImageJ. **You will repeate the following steps for each measurement**:
    + Click on the **Straight** toolbox
<br><br>

<center>
    ```{r echo=FALSE,fig.asp=.1}
library(png)
library(grid)
img <- readPNG("image2.png")
 grid.raster(img)
```
</center>
<br>

4. Got to the main menu bar
    + Go to File -> Open. Select an image for analyzis. There are a total of 12 images you should analyze. Note that you can zoom in and out the image to desired view using standard shortcuts or clicking Image -> Zoom
    + Set the image scale. To set the scale, drag the cursor from one hatch mark to the next to achieve 1cm (see image below).
    + Go to Analyze -> Set Scale. In “Known distance”, type "1" and in “Unit of length” type "cm". Leave the rest as is. Hit “OK”. **This steps is very important, you are assigning a reference that the software will use to determine the magnitude of your measurements**. You are now ready to measure!

<center>
```{r echo=FALSE,out.width = '60%'}
library(png)
library(grid)
img <- readPNG("image3.png")
 grid.raster(img)
```
</center>

5. Measure the canine length
    + Drag the cursor to create a line from the tip of the tooth to the uppermost part attached to the base.
    + Go to Analyze -> Measure.  A chart should appear with multiple measurements including “Length” (see figure below).
    + Go to your excel file and record the twelve measurements. Don’t forget to include the id and tooth you just measured!
<br>

```{r echo=FALSE,fig.align="center",fig.asp=.4,fig.width = 9}
library(png)
library(grid)
img <- readPNG("image1.png")
 grid.raster(img)
```

<br><br>
<style>
body {
text-align: justify}
div.creme { background-color:#fff5e6; border-radius: 5px; padding: 20px;}
</style>
<div class = "creme">

<span style='color:blue; font-size:120%; font-weight:600'> **Info-Box!** </span> Before any data analysis, there is a very important step; that of **data management**. Through the process of data management, we are able to arrange our dataset appropriately for analysis. Thus, there are generalizations on how to do good data management. 

**Rules for good spreadsheets:**

  + **Variables** are assigned to columns 
  + **Observations** (individuals) are assigned to rows
  + **Blanks** or missing data should be replaced with "NA" 
</div>
<br>

**B. Data analysis**

Summarize the results of your image analysis for each canine and estimate measurment accuracy and precision. Include:

  + *minimum* and *maximum* length measurements
  + *range* or the difference between the minimum and maximum length
  + *mean* (average) canine length
  + *accuracy*
  + *precision*

<br>
Although we just have a sample size of three (i.e., three images per canine), let's practice how to get this simple summary in R. **Note:** the example below follows the suggested heading of the data in Part A. 

1. Import your data to RStudio. For simplicity, let's call our data object "canine". **Hint:** check out our past exercise's script!
```{r,eval=FALSE}
# Importing data
canine <- read.csv("canine.csv",header=TRUE)

# viewing the data
canine
```
<br>

2. Summarize your data across teeth type. For that, we can use the function **summary()**.
```{r,eval=FALSE}
# summarizing the data
s <- summary(canine)
s
```
<br>
**Questions**
<br>

a) *What does each column in your summary represent?*
b) *Do you have the expected sample size per canine?*

<br>

3. Summarize the data across teeth type, step-by-step. As any language, there are many different ways to "say" the same. That is, other functions exist to estimate the same data summary. However, they may need a bit more coding. For instances, to get the minimum value of a column in our data we can use the function **min()** but we need to explicitly indicate the column of interest with the **$** sign (meaning "within"):
```{r,eval=FALSE}
# minimum value
m1 <- min(canine$length_cm)
m1

# maximum value
m2 <- max(canine$length_cm)
m2

# mean value
m3 <- mean(canine$length_cm)
m3

# range between minimum and maximum values (precision)
r <- m2-m1
r
```
<br>

Assuming a true value of canine length, say TV (check with the instructor), an approximation of the accuracy of our estimates can be calculated as the difference between the mean estimate and TV.
```{r,eval=FALSE}
# difference between the mean and the true value (accuracy).  
m3-TV

# using absolute value
abs(m3-TV) 
```
<br>

However, we know that there is a lot of variation among different teeth. So, let's now carry out the data summary for **each** teeth to estimate the accuracy and precision of our measurements. This involves a bit of data management. Let's use the package *tidyverse* to filter by tooth and estimate the summary. **Hint:** check out our past exercise's script! 

```{r,eval=FALSE}
# loading the package
library(tidyverse)

# viewing the data
canine

# filtering by the lower left canine
ll <- filter(canine,tooth=="lwr-left")
ll

# summary
summary(ll)

# precision
max(ll$length_cm) - min(ll$length_cm)

# accuracy
abs(
  mean(ll$length_cm)-TV
  ) 
```
<br>
**Questions**

a) *How precise were your measurements of the lower-left canine length?* **Hint**: When referring to precision, we refer to the spread of measurements resulting from sampling error. That is, how much variation was there in making the measurements and how much each measurement agrees with each other.  

b) *How accurate was your mean length measurement?* **Hint**: When referring to accuracy, we refer to the closeness of the measurements to the true value.

c) *What factors/processes do you think could have influenced accuracy and precision?* **Hint**: Think about the logistics involving digital image analysis and ImageJ, the potential biases and objectivity in measurement recording.  

d) *What changes can you make in the future to increase measurement accuracy and precision?*
<br><br>

<span style='color:#66023C; font-size:100%; font-weight:600'> **Stop, Think, Do:** </span> Now, it is your turn to estimate the descriptive summary for the other 3 canines in your data and quantify accuracy and precision. **Stop** and review the codes you just ran. **Think** about how you could manipulate such codes in order to do the same analysis for the other canines. *Hint:* give appropriate names to each object. Such names should not overwright previous ones. **Do** the analysis and be ready to present it!
<br> 


<center>
**Great Work!**
</center>
<br>

*** 

<span style='color:#66023C; font-size:150%; font-weight:600'> Take-home exercise </span> 
<br> 

Now is your turn to analyze... ADD TEXT HERE.
